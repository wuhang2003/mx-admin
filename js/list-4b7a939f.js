import{d,u as x,E as k,f as D,w as R,j as T,k as t,F,R as n,A as C,C as N,m as B,M as p,s as m,p as i,t as M}from"./index-b99e499e.js";import{D as S}from"./delete-confirm-aa2f96a9.js";import{T as A}from"./index-4dd5932f.js";import{R as L}from"./relative-time-ed24f7c6.js";import{u as b}from"./use-table-d5f5ecd6.js";import{H as E}from"./rounded-button-9462c134.js";import{N as K}from"./Popconfirm-b6875846.js";import"./DataTable-5b13423f.js";import"./ChevronRight-2ffd4610.js";import"./Checkbox-d30ebe53.js";import"./Select-11727ae9.js";import"./Tag-3f8dfd3a.js";import"./Pagination-ad0d854c.js";import"./prop-8b8caa29.js";import"./Forward-6b21d7af.js";import"./Tooltip-9d357d18.js";const ee=d({name:"SayList",setup(P,V){const{checkedRowKeys:o,data:y,pager:r,loading:f,fetchDataFn:g}=b((a,e)=>async(v=l.query.page||1,w=30)=>{const c=await n.api.says.get({params:{page:v,size:w,select:"title text _id id created modified author source"}});a.value=c.data,e.value=c.pagination}),u=x();k();const l=D(),s=g;R(()=>l.query.page,async a=>{await s(a)}),T(async()=>{await s()});const h=d({setup(){const a=B([{type:"selection",options:["none","all"]},{title:"创建于",key:"created",width:100,render(e){return t(p,{to:`/says/edit?id=${e.id}`},{default:()=>[t(L,{time:e.created},null)]})}},{title:"内容",key:"text"},{title:"作者",key:"author"},{title:"来源",key:"source"},{title:"操作",fixed:"right",key:"id",width:130,render(e){return t(M,{wrap:!1},{default:()=>[t(p,{to:`/says/edit?id=${e.id}`},{default:()=>[t(m,{text:!0,type:"primary",size:"tiny"},{default:()=>[i("编辑")]})]}),t(K,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await n.api.says(e.id).delete(),u.success("删除成功"),await s(r.value.currentPage)}},{trigger:()=>t(m,{text:!0,type:"error",size:"tiny"},{default:()=>[i("移除")]}),default:()=>t("span",{class:"max-w-48"},[i("确定要删除“"),e.text,i("” ?")])})]})}}]);return()=>t(A,{loading:f.value,columns:a,data:y,onFetchData:s,pager:r,onUpdateCheckedRowKeys:e=>{o.value=e}},null)}});return()=>t(N,null,{actions:()=>t(F,null,[t(S,{checkedRowKeys:o.value,onDelete:async()=>{const a=await Promise.allSettled(o.value.map(e=>n.api.says(e).delete()));for(const e of a)e.status==="rejected"&&u.success(`删除失败，${e.reason.message}`);o.value.length=0,s()}},null),t(E,{to:"/says/edit",icon:t(C,null,null)},null)]),default:()=>t(h,null,null)})}});export{ee as default};
