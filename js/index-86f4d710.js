import{H as h}from"./rounded-button-6d996a7f.js";import{d as x,s as u,w as y,g as b,R as i,h as t,N as F,J as p,l as T,k as d,K as k,aN as w,j as C,bx as E,aw as U,F as B,as as A,C as S}from"./index-de880b68.js";import{T as I}from"./index-4198606e.js";import{N as M,a as g}from"./Tabs-9d7a4c61.js";import{N as P}from"./Image-c88352d0.js";import{N as j}from"./ButtonGroup-00f6ded0.js";import{N as z}from"./Popconfirm-68148b10.js";import{a as D,N as J}from"./Upload-ceb7b30f.js";import"./DataTable-37b757f1.js";import"./ChevronRight-c1a13d6d.js";import"./Checkbox-56d171ac.js";import"./Select-869e5aed.js";import"./Tag-27f80eab.js";import"./Pagination-90ffca1a.js";import"./prop-8b8caa29.js";import"./Forward-feceacfb.js";import"./Ellipsis-267623b1.js";import"./Tooltip-aa7130af.js";import"./Add-f63633f5.js";import"./throttle-4cca4ac7.js";import"./utils-cd6c13c0.js";const ue=x({setup(){const a=u("icon"),l=u([]);y(()=>a.value,()=>{m()}),b(()=>{m()});const n=u(!1),m=()=>{n.value=!0,i.api.files(a.value).get().then(({data:e})=>{l.value=e,n.value=!1})},o=u(!1),v=async e=>{if(a.value==="icon"){if(e.file.file?.type.startsWith("image"))return!0;message.error("只能上传图片文件，请重新上传")}return!1},N=({file:e,event:r})=>{const s=r?.target,{url:c,name:f}=JSON.parse(s.responseText);return e.name=f,e.url=c,l.value.unshift({url:c,name:f}),e};return()=>t(S,{actionsElement:t(B,null,[t(h,{variant:"info",onClick:()=>{o.value=!0},icon:t(A,null,null)},null)])},{default:()=>[t(M,{value:a.value,onUpdateValue:e=>{a.value=e}},{default:()=>[t(g,{tab:"图标",name:"icon"},null),t(g,{tab:"头像",name:"avatar"},null)]}),t(I,{loading:n.value,data:l,columns:[{key:"name",title:"文件名",width:300,ellipsis:{lineClamp:1,tooltip:!0}},{key:"url",title:"URL",render(e){return t(F,{placement:"bottom",class:"max-w-[400px]"},{trigger(){return t("a",{href:e.url,target:"_blank"},[e.url])},default(){return t(p,{bordered:!0},{default:()=>[t(P,{src:e.url},null)]})}})}},{key:"action",title:"操作",width:150,render(e){return t(j,null,{default:()=>[t(z,{onPositiveClick:()=>{i.api.files(a.value)(e.name).delete().then(()=>{message.success("删除成功"),l.value=l.value.filter(r=>r.name!==e.name)})}},{trigger(){return t(T,{text:!0,type:"error",tertiary:!0,size:"tiny"},{default:()=>[d("删除")]})},default(){return`确定要删除 ${e.name} 吗？`}})]})}}]},null),t(k,{closable:!0,closeOnEsc:!0,onClose:()=>{o.value=!1},show:o.value,onUpdateShow:e=>{o.value=e}},{default:()=>[t(p,{title:"文件上传",class:"modal-card sm flex justify-center",closable:!0,onClose:()=>{o.value=!1}},{default:()=>[t(D,{class:"flex flex-col items-center w-full",headers:{authorization:w()||""},action:`${i.endpoint}/files/upload?type=${a.value}`,"directory-dnd":!0,multiple:!0,onBeforeUpload:v,onFinish:N,onError:e=>{const r=e.event?.target;if(e.file.status="error",!r)return message.warning("网络异常"),e.file;const{message:s}=JSON.parse(r.responseText);return message.warning(s),e.file}},{default:()=>[t(J,{class:"flex flex-col items-center justify-center w-full m-auto py-28"},{default:()=>[t(C,{size:"48",depth:"3"},{default:()=>[t(E,null,null)]}),t(U,{class:"mt-2"},{default:()=>[d("点击或者拖动文件到该区域来上传")]})]})]})]})]})]})}});export{ue as default};
