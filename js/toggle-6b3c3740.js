import{k as m,ag as N,ah as B,ai as p,y as d,bM as z,au as S,U as t,ck as E,n as A,ak as L,br as R}from"./Button-5ec267f1.js";import{u as x}from"./use-react-44edf12c.js";import{a1 as T,a2 as U,a0 as W,g as $}from"./app-4e878528.js";import{N as j,I as y,n as D}from"./use-store-ref-4d0ce661.js";import{e as b,u as P,s as k}from"./use-editor-setting-75d4c3e0.js";import{_ as w}from"./preload-helper-f651ca80.js";import{u as q}from"./use-save-confirm-4b573eea.js";import{N as _}from"./Spin-2c3e5ca3.js";import{t as H}from"./throttle-f16fb0de.js";import{b as K}from"./Card-73dd4072.js";import{N as G}from"./Form-4f2beb1e.js";import{N as J}from"./FormItem-32059e79.js";import{N as Q}from"./Select-410a3ac9.js";const X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Y=p("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",fill:"currentColor"},null,-1),Z=[Y],ee=m({name:"FullscreenExitOutlined",render:function(r,o){return N(),B("svg",X,Z)}}),te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},oe=p("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[p("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065z"}),p("circle",{cx:"12",cy:"12",r:"3"})],-1),ne=[oe],re=m({name:"Settings",render:function(r,o){return N(),B("svg",te,ne)}}),V={editor:"editor-pref",general:"editor-general"};var s=(e=>(e.monaco="monaco",e.codemirror="codemirror",e.plain="plain",e))(s||{});const C=m({props:{...b,wrapperProps:{type:Object,required:!1}},setup(e){const r=d();let o=z(e.text);S(()=>e.text,l=>{!o&&l&&(o=l)}),q(e.unSaveConfirm,()=>o===e.text);const{general:{setting:{autocorrect:u}}}=P(),i=l=>{u&&l.key==="Enter"&&w(()=>import("./autocorrect-55e57c14.js"),[]).then(({format:h})=>{const f=h(l.target.value);e.onChange(f)}).catch(()=>{console.log("not support wasm")})};return()=>t("div",e.wrapperProps,[t(j,{onKeydown:i,ref:r,type:"textarea",onInput:l=>void e.onChange(l),value:e.text,class:"h-full"},null)])}}),c={[s.monaco]:null,[s.plain]:null,[s.codemirror]:null},g=e=>{if(c[e])return c[e];switch(e){case"monaco":{const r=E({loader:()=>w(()=>import("./monaco-1b0b049a.js"),["js/monaco-1b0b049a.js","js/preload-helper-f651ca80.js","js/index-6b1ba934.js","js/use-store-ref-4d0ce661.js","js/Button-5ec267f1.js","js/Spin-2c3e5ca3.js","js/use-save-confirm-4b573eea.js","js/use-editor-setting-75d4c3e0.js","js/throttle-f16fb0de.js","js/FormItem-32059e79.js","js/context-2fd66e76.js","js/light-50e066bd.js","js/InputNumber-409daacb.js","js/Remove-3934817c.js","js/Add-89af046c.js","js/Switch-82196aed.js","js/_common-6222e43f.js","assets/use-editor-setting-8179fa28.css"]).then(o=>o.MonacoEditor),loadingComponent:t(_,{strokeWidth:14,show:!0,rotate:!0},null),suspensible:!0});return c[e]=r,r}case"plain":return c[e]=C,C;case"codemirror":{const r=E({loader:()=>w(()=>import("./codemirror-be88fa51.js").then(o=>o.x),["js/codemirror-be88fa51.js","js/use-save-confirm-4b573eea.js","js/use-store-ref-4d0ce661.js","js/Button-5ec267f1.js","js/use-editor-setting-75d4c3e0.js","js/throttle-f16fb0de.js","js/FormItem-32059e79.js","js/context-2fd66e76.js","js/light-50e066bd.js","js/InputNumber-409daacb.js","js/Remove-3934817c.js","js/Add-89af046c.js","js/Switch-82196aed.js","js/_common-6222e43f.js","assets/use-editor-setting-8179fa28.css","js/preload-helper-f651ca80.js","assets/codemirror-57b15ec7.css"]).then(o=>o.CodemirrorEditor),loadingComponent:t(_,{strokeWidth:14,show:!0,rotate:!0},null),suspensible:!0});return c[e]=r,r}default:return null}};const le=()=>{const e=localStorage.getItem(V.editor);if(!e)return null;try{const r=JSON.parse(e);return Object.keys(s).includes(r)?r:null}catch{return null}},_e=m({name:"EditorToggleWrapper",props:{...b,loading:{type:Boolean,required:!0}},setup(e){const r=le(),o=d(r??s.codemirror),u=d(!1),i=T(),l=d();x(()=>{const n=i.addFloatButton(t("button",{onClick:()=>{u.value=!0}},[t(y,{size:18},{default:()=>[t(re,null,null)]})])),v=i.addFloatButton(t("button",{onClick:()=>{l.value?.$el.requestFullscreen()}},[t(y,{size:18},{default:()=>[t(ee,null,null)]})]));return()=>{i.removeFloatButton(n),i.removeFloatButton(v)}}),x(()=>{document.addEventListener("fullscreenchange",()=>{document.fullscreenElement===l.value?document.documentElement.classList.add("editor-fullscreen"):document.documentElement.classList.remove("editor-fullscreen")})}),S(()=>o.value,H(n=>{localStorage.setItem(V.editor,JSON.stringify(n))},300,{trailing:!0}));const h=d(),{general:f}=P(),F=A(()=>{if(e.loading)return t("div",{class:[k.editor,k.loading]},[t(_,{strokeWidth:14,show:!0,rotate:!0},null)]);switch(o.value){case"monaco":{const n=g(o.value);return t(n,L({ref:h},e),null)}case"plain":{const n=g(o.value);return t(n,e,null)}case"codemirror":{const n=g(o.value);return t(n,e,null)}default:return null}}),I=m({setup(){const n=()=>{u.value=!1},{Panel:v}=f,O=a=>void(o.value=a),M=a=>void(u.value=a);return()=>t($,{transformOrigin:"center",show:u.value,onUpdateShow:M},{default:()=>[t(K,{closable:!0,onClose:n,title:"编辑器设定",style:"max-width: 90vw;width: 500px; max-height: 65vh; overflow: auto",bordered:!1},{default:()=>[t(D,{class:"text-center"},{default:()=>[t(W,{depth:"3"},{default:()=>[R("此设定仅存储在本地！")]})]}),t(G,{labelPlacement:"left",labelWidth:"8rem",labelAlign:"right"},{default:()=>[t(J,{label:"编辑器选择"},{default:()=>[t(Q,{value:o.value,onUpdateValue:O,options:Object.keys(s).map(a=>({key:a,label:a,value:a}))},null)]}),t(v,null,null)]})]})]})}});return()=>{const{setting:n}=f;return t(U,{tag:"div",style:{"--editor-font-size":n.fontSize?`${n.fontSize/14}rem`:"","--editor-font-family":n.fontFamily},class:"editor-wrapper",ref:l},{default:()=>[F.value,t(I,null,null)]})}}});export{_e as E,C as P};
