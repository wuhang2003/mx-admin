import{k as m,ag as b,ah as B,ai as p,y as d,bM as A,au as S,U as t,ck as x,bz as L,n as R,ak as T,br as U}from"./Button-5ec267f1.js";import{u as y}from"./use-react-44edf12c.js";import{a1 as W,a2 as $,a0 as j,g as D}from"./app-447ba742.js";import{N as q,I as k,n as H}from"./use-store-ref-095f705c.js";import{e as P,u as V,s as C}from"./use-editor-setting-7ae75e12.js";import{_ as w}from"./preload-helper-f651ca80.js";import{u as K}from"./use-save-confirm-5396f481.js";import{N as _}from"./Spin-2c3e5ca3.js";import{t as G}from"./throttle-0ce18ecc.js";import{b as J}from"./Card-73dd4072.js";import{N as Q}from"./Form-4f2beb1e.js";import{N as X}from"./FormItem-32059e79.js";import{N as Y}from"./Select-410a3ac9.js";const Z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ee=p("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",fill:"currentColor"},null,-1),te=[ee],oe=m({name:"FullscreenExitOutlined",render:function(r,o){return b(),B("svg",Z,te)}}),ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},re=p("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[p("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065z"}),p("circle",{cx:"12",cy:"12",r:"3"})],-1),le=[re],ae=m({name:"Settings",render:function(r,o){return b(),B("svg",ne,le)}}),F={editor:"editor-pref",general:"editor-general"};var s=(e=>(e.monaco="monaco",e.codemirror="codemirror",e.plain="plain",e))(s||{});const N=m({props:{...P,wrapperProps:{type:Object,required:!1}},setup(e){const r=d();let o=A(e.text);S(()=>e.text,l=>{!o&&l&&(o=l)}),K(e.unSaveConfirm,()=>o===e.text);const{general:u}=V(),i=l=>{u.setting.autocorrect&&l.key==="Enter"&&w(()=>import("./autocorrect-55e57c14.js"),[]).then(({format:f})=>{const h=f(l.target.value);e.onChange(h)}).catch(()=>{console.log("not support wasm")})};return()=>t("div",e.wrapperProps,[t(q,{onKeydown:i,ref:r,type:"textarea",onInput:l=>void e.onChange(l),value:e.text,class:"h-full"},null)])}}),c={[s.monaco]:null,[s.plain]:null,[s.codemirror]:null},g=e=>{if(c[e])return c[e];switch(e){case"monaco":{const r=x({loader:()=>w(()=>import("./monaco-275840eb.js"),["js/monaco-275840eb.js","js/preload-helper-f651ca80.js","js/index-6a5b60dd.js","js/use-store-ref-095f705c.js","js/Button-5ec267f1.js","js/Spin-2c3e5ca3.js","js/use-save-confirm-5396f481.js","js/use-editor-setting-7ae75e12.js","js/throttle-0ce18ecc.js","js/FormItem-32059e79.js","js/context-2fd66e76.js","js/light-50e066bd.js","js/InputNumber-5d4e37b9.js","js/Remove-3934817c.js","js/Add-89af046c.js","js/Switch-82196aed.js","js/_common-6222e43f.js","assets/use-editor-setting-8179fa28.css"]).then(o=>o.MonacoEditor),loadingComponent:t(_,{strokeWidth:14,show:!0,rotate:!0},null),suspensible:!0});return c[e]=r,r}case"plain":return c[e]=N,N;case"codemirror":{const r=x({loader:()=>w(()=>import("./codemirror-d7ec5d13.js").then(o=>o.x),["js/codemirror-d7ec5d13.js","js/use-save-confirm-5396f481.js","js/use-store-ref-095f705c.js","js/Button-5ec267f1.js","js/use-editor-setting-7ae75e12.js","js/throttle-0ce18ecc.js","js/FormItem-32059e79.js","js/context-2fd66e76.js","js/light-50e066bd.js","js/InputNumber-5d4e37b9.js","js/Remove-3934817c.js","js/Add-89af046c.js","js/Switch-82196aed.js","js/_common-6222e43f.js","assets/use-editor-setting-8179fa28.css","js/preload-helper-f651ca80.js","assets/codemirror-57b15ec7.css"]).then(o=>o.CodemirrorEditor),loadingComponent:t(_,{strokeWidth:14,show:!0,rotate:!0},null),suspensible:!0});return c[e]=r,r}default:return null}};const se=()=>{const e=localStorage.getItem(F.editor);if(!e)return null;try{const r=JSON.parse(e);return Object.keys(s).includes(r)?r:null}catch{return null}},xe=m({name:"EditorToggleWrapper",props:{...P,loading:{type:Boolean,required:!0}},setup(e){const r=se(),o=d(r??s.codemirror),u=d(!1),i=W(),l=d();y(()=>{const n=i.addFloatButton(t("button",{onClick:()=>{u.value=!0}},[t(k,{size:18},{default:()=>[t(ae,null,null)]})])),v=i.addFloatButton(t("button",{onClick:()=>{l.value?.$el.requestFullscreen()}},[t(k,{size:18},{default:()=>[t(oe,null,null)]})]));return()=>{i.removeFloatButton(n),i.removeFloatButton(v)}}),y(()=>{document.addEventListener("fullscreenchange",()=>{document.fullscreenElement===l.value?document.documentElement.classList.add("editor-fullscreen"):document.documentElement.classList.remove("editor-fullscreen")})}),S(()=>o.value,G(n=>{localStorage.setItem(F.editor,JSON.stringify(n))},300,{trailing:!0}));const E=d(),{general:f,destory:h}=V();L(()=>{h()});const I=R(()=>{if(e.loading)return t("div",{class:[C.editor,C.loading]},[t(_,{strokeWidth:14,show:!0,rotate:!0},null)]);switch(o.value){case"monaco":{const n=g(o.value);return t(n,T({ref:E},e),null)}case"plain":{const n=g(o.value);return t(n,e,null)}case"codemirror":{const n=g(o.value);return t(n,e,null)}default:return null}}),O=m({setup(){const n=()=>{u.value=!1},{Panel:v}=f,z=a=>void(o.value=a),M=a=>void(u.value=a);return()=>t(D,{transformOrigin:"center",show:u.value,onUpdateShow:M},{default:()=>[t(J,{closable:!0,onClose:n,title:"编辑器设定",style:"max-width: 90vw;width: 500px; max-height: 65vh; overflow: auto",bordered:!1},{default:()=>[t(H,{class:"text-center"},{default:()=>[t(j,{depth:"3"},{default:()=>[U("此设定仅存储在本地！")]})]}),t(Q,{labelPlacement:"left",labelWidth:"8rem",labelAlign:"right"},{default:()=>[t(X,{label:"编辑器选择"},{default:()=>[t(Y,{value:o.value,onUpdateValue:z,options:Object.keys(s).map(a=>({key:a,label:a,value:a}))},null)]}),t(v,null,null)]})]})]})}});return()=>{const{setting:n}=f;return t($,{tag:"div",style:{"--editor-font-size":n.fontSize?`${n.fontSize/14}rem`:"","--editor-font-family":n.fontFamily},class:"editor-wrapper",ref:l},{default:()=>[I.value,t(O,null,null)]})}}});export{xe as E,N as P};
