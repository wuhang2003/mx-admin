import{H as M}from"./rounded-button-308fbee1.js";import{M as O,T as E,P as H,S as $}from"./parse-content-9edd44ab.js";import{E as B}from"./toggle-39aa65af.js";import{R as p,d as N,f as D,h as z,i as F,j as h,m as L,l as C,v as d,u as A,x as W,y as q,k as t,W as j,z as _,F as x,T as Y,I as G,C as J,D as K,E as Q}from"./index-3c95053e.js";import{U as X}from"./underline-input-f6f70093.js";import{c as Z}from"./use-memo-fetch-data-list-dadcacc2.js";import{N as ee}from"./DynamicTags-b3f95c69.js";import{i as ae}from"./isString-0c89ce41.js";import{N as r}from"./FormItem-4a41af9c.js";import{N as b}from"./Select-f4a51811.js";import{N as S}from"./Switch-9ade454a.js";import{N as te}from"./InputNumber-8dd0a70c.js";import"./marked.esm-75dc6516.js";import"./DatePicker-50faa177.js";import"./ChevronRight-32b86c47.js";import"./Forward-6cab11cb.js";import"./Form-a73db28e.js";import"./ButtonGroup-d351298b.js";import"./use-async-monaco-91c11c5a.js";import"./index-6c84ec68.js";import"./index-1b8f17cb.js";import"./use-save-confirm-a2fbb639.js";import"./DynamicInput-0c5f3a4d.js";import"./Add-06359a2d.js";import"./Remove-ad107eb7.js";import"./vue.runtime.esm-bundler-4118a185.js";import"./js-yaml-e14800c0.js";import"./use-react-aa36ef57.js";import"./throttle-d02e3100.js";import"./Tag-e0bc3d96.js";import"./prop-8b8caa29.js";const le=Z(g=>p.api.posts.get({params:{page:g,size:50,select:"id title nid _id slug category categoryId"}})),He=N(()=>{const g=D(),i=z(F);h(async()=>{await i.fetch()});const R=()=>({categoryId:i.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0,pin:!1,pinOrder:1,relatedId:[],created:void 0}),T=e=>{const l=K(a),n=Object.keys(l);for(const o in e)n.includes(o)&&(a[o]=e[o])},s=le(),a=L(R()),u=C(()=>g.query.id),f=C(()=>i.get(a.categoryId)||i.data?.value?.[0]||{});h(async()=>{const e=u.value;if(e&&typeof e=="string"){const l=await p.api.posts(e).get();l.data.relatedId=l.data.related?.map(n=>n.id)||[],s.append(l.data.related),T(l.data)}});const v=d(!1),I=A(),U=W(),P=async()=>{const e={...a,categoryId:f.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(u.value){if(!ae(u.value))return;const l=u.value;await p.api.posts(l).put({data:e}),I.success("修改成功")}else await p.api.posts.post({data:e}),I.success("发布成功");U.push({name:Q.ViewPost,hash:"|publish"})},k=()=>{v.value=!0,s.loading.value&&s.fetchNext()},V=e=>{const l=e.currentTarget;l.scrollTop+l.offsetHeight+10>=l.scrollHeight&&s.fetchNext()};return q(()=>{s.refresh()}),()=>t(J,{title:u.value?"修改文章":"撰写新文章",actionsElement:t(x,null,[t(H,{data:a,onHandleYamlParsedMeta:e=>{const{title:l,slug:n,...o}=e;a.title=l??a.title,a.slug=n??a.slug,a.meta={...o}}},null),t(M,{icon:t(Y,null,null),onClick:P},null)]),footerButtonElement:t(x,null,[t("button",{onClick:k},[t(G,null,{default:()=>[t($,null,null)]})])])},{default:()=>[t(O,{class:"mt-3 relative z-10",label:"想想取个什么标题好呢~",value:a.title,onChange:e=>{a.title=e}},null),t("div",{class:"text-gray-500 py-3"},[t("label",{class:"prefix"},[`${j}/${f.value.slug}/`]),t(X,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}},null)]),t(B,{loading:!!(u.value&&typeof a.id>"u"),onChange:e=>{a.text=e},text:a.text},null),t(E,{show:v.value,onUpdateShow:e=>{v.value=e},data:a},{default:()=>[t(r,{label:"分类",required:!0,path:"category"},{default:()=>[t(b,{placeholder:"请选择",value:f.value.id,onUpdateValue:e=>{a.categoryId=e},options:i.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),t(r,{label:"标签"},{default:()=>[t(ee,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){return t(N({setup(){const n=d([]),o=d(!1),w=d(""),y=d();return h(async()=>{o.value=!0,y.value&&y.value.$el.querySelector("input").focus();const{data:m}=await p.api.categories.get({params:{type:"Tag"}});n.value=m.map(c=>({label:`${c.name} (${c.count})`,value:c.name,key:c.name})),o.value=!1}),()=>t(b,{ref:y,size:"small",value:w.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:m=>{w.value=m,e(m)}},null)}}),null,null)}})]}),t(r,{label:"关联阅读"},{default:()=>[t(b,{maxTagCount:3,filterable:!0,clearable:!0,loading:s.loading.value,multiple:!0,onClear:()=>{s.refresh()},value:a.relatedId,onUpdateValue:e=>{a.relatedId=e},resetMenuOnOptionsChange:!1,options:s.datalist.value.map(e=>({label:e.title,value:e.id,key:e.id,disabled:e.id==a.id})),onScroll:V},null)]}),t(r,{label:"概要"},{default:()=>[t(_,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"文章概要",value:a.summary,onInput:e=>void(a.summary=e)},null)]}),t(r,{label:"版权注明",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(S,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)},null)]}),t(r,{label:"置顶",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(S,{value:!!a.pin,onUpdateValue:e=>{a.pin=e,e||(a.pinOrder=1)}},null)]}),t(r,{label:"置顶顺序",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(te,{disabled:!a.pin,value:a.pinOrder,onUpdateValue:e=>void(a.pinOrder=e||1)},null)]})]})]})});export{He as default};
