import{T as S}from"./index-5dcc3327.js";import{R as B}from"./relative-time-63e04db0.js";import{u as F}from"./use-table-4e924bc1.js";import{d as c,b as T,s as x,al as k,R as i,w as C,g as E,i as R,h as t,l as D,k as u,m,C as M,L as A}from"./index-0c9d0a31.js";import{S as O,b as j,c as q,d as L}from"./index-0883cb41.js";import{N as P}from"./Popconfirm-22454fce.js";import{N as V}from"./Tag-61b52a1b.js";import{N as K}from"./Switch-6b2c7cd7.js";import"./DataTable-44652ee6.js";import"./ChevronRight-358b32b9.js";import"./Checkbox-a6c172de.js";import"./Select-bad467d1.js";import"./Pagination-78a86f4b.js";import"./prop-8b8caa29.js";import"./Forward-2f984f07.js";import"./Ellipsis-bca76543.js";import"./Tooltip-54ba230e.js";const z=new Map([[O,"博文"],[j,"手记"],[q,"速记"],[L,"说说"]]);function b(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!A(a)}const ue=c({setup(){const a=T(),r=x(!1);k(async()=>{const e=await i.api.subscribe.status.get().then(o=>o.enable);r.value=e});const s=async()=>{await i.api.options("featureList").patch({data:{emailSubscribe:!r.value}}),r.value=!r.value},{loading:f,checkedRowKeys:g,data:y,pager:l,fetchDataFn:p}=F((e,o)=>async(w=a.query.page||1,N=10)=>{const d=await i.api.subscribe.get({params:{page:w,size:N,sortBy:"created",sortOrder:"-1"}});e.value=d.data,o.value=d.pagination}),n=p;C(()=>a.query.page,async e=>{await n(e)}),E(async()=>{await p()});const h=R(()=>[{title:"邮箱",key:"email",ellipsis:{tooltip:!0},width:140},{title:"订阅内容",key:"subscribe",width:250,render(e){return t(U,{bit:e.subscribe},null)}},{title:"创建于",width:250,key:"created",sortOrder:"descend",render(e){return t(B,{time:e.created},null)}},{title:"操作",fixed:"right",width:40,key:"id",render(e){return t(m,null,{default:()=>[t(P,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await i.api.subscribe.unsubscribe.get({params:{email:e.email,cancelToken:e.cancelToken}}),message.success("删除成功"),await n(l.value.currentPage)}},{trigger:()=>t(D,{text:!0,type:"error",size:"tiny"},{default:()=>[u("移除")]}),default:()=>t("span",{class:"max-w-48"},[u("确定要删除 "),e.title,u("？")])})]})}}]),v=c(()=>()=>t("div",{class:"inline-flex items-center"},[t("span",null,[u("邮件订阅开启状态：")]),t(K,{value:r.value,onChange:s},null)]));return()=>t(M,{description:t(v,null,null)},{default:()=>[t(S,{data:y,loading:f.value,columns:h.value,onFetchData:n,pager:l,onUpdateCheckedRowKeys:e=>{g.value=e}},null)]})}}),U=c({props:{bit:{type:Number,required:!0}},render(){const a=[];for(const[r,s]of z.entries())r&this.bit&&a.push(t(V,{round:!0},b(s)?s:{default:()=>[s]}));return t(m,null,b(a)?a:{default:()=>[a]})}});export{U as SubscribeBit,ue as default};
