import{H as V}from"./rounded-button-6b29b554.js";import{M as O,T as B,P as H,S as $}from"./parse-content-c04d1ae5.js";import{E}from"./toggle-ebc9f5d1.js";import{x as m,q as D,T as F,Z as L,K as q,R as z}from"./app-5a2221a4.js";import{U as A}from"./underline-input-2e9afc73.js";import{r as W,i as _,f as j,N as K,I as Y}from"./use-store-ref-0fa0f74b.js";import{u as Z}from"./category-cd288759.js";import{c as G}from"./use-memo-fetch-data-list-d3f801ad.js";import{N as J}from"./DynamicTags-30a68e84.js";import{i as Q}from"./isString-9cfa0708.js";import{k as N,R as h,B as X,n as x,y as p,ar as ee,U as a,F as C,bM as te}from"./Button-5ec267f1.js";import{N as n}from"./FormItem-32059e79.js";import{N as b}from"./Select-410a3ac9.js";import{N as S}from"./Switch-82196aed.js";import{N as ae}from"./InputNumber-528a26c3.js";import"./preload-helper-f651ca80.js";import"./marked.esm-75dc6516.js";import"./DatePicker-39b65117.js";import"./fade-in-height-expand.cssr-7a0e6e1d.js";import"./light-69276dac.js";import"./ChevronRight-54213128.js";import"./Forward-414cae36.js";import"./Card-73dd4072.js";import"./Form-4f2beb1e.js";import"./context-2fd66e76.js";import"./light-50e066bd.js";import"./light-3afc884b.js";import"./ButtonGroup-61958723.js";import"./use-async-monaco-a28c8a58.js";import"./index-f48bd189.js";import"./Spin-2c3e5ca3.js";import"./index-1b8f17cb.js";import"./editor.main-dc93c917.js";import"./editor.api-4e51eec6.js";import"./monaco.contribution-6af567af.js";import"./use-save-confirm-7fb4feea.js";import"./DynamicInput-72de1ea5.js";import"./_common-202f2abd.js";import"./Add-89af046c.js";import"./Remove-3934817c.js";import"./vue.runtime.esm-bundler-8c96fb9f.js";import"./js-yaml-e14800c0.js";import"./use-react-44edf12c.js";import"./use-editor-setting-064c09cf.js";import"./throttle-77fca6da.js";import"./Tag-62076a6b.js";import"./_common-991711fd.js";import"./prop-8b8caa29.js";import"./light-1d805342.js";import"./_common-6222e43f.js";const le=G(f=>m.api.posts.get({params:{page:f,size:50,select:"id title nid _id slug category categoryId"}})),et=N(()=>{const f=W(),u=_(Z);h(async()=>{await u.fetch()});const R=()=>({categoryId:u.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0,pin:!1,pinOrder:1,relatedId:[],created:void 0}),U=e=>{const l=te(t),s=Object.keys(l);for(const o in e)s.includes(o)&&(t[o]=e[o])},r=le(),t=X(R()),i=x(()=>f.query.id),g=x(()=>u.get(t.categoryId)||u.data?.value?.[0]||{});h(async()=>{const e=i.value;if(e&&typeof e=="string"){const l=await m.api.posts(e).get();l.data.relatedId=l.data.related?.map(s=>s.id)||[],r.append(l.data.related),U(l.data)}});const v=p(!1),I=D(),T=j(),P=async()=>{const e={...t,categoryId:g.value.id,summary:t.summary&&t.summary.trim()!=""?t.summary.trim():null};if(i.value){if(!Q(i.value))return;const l=i.value;await m.api.posts(l).put({data:e}),I.success("修改成功")}else await m.api.posts.post({data:e}),I.success("发布成功");T.push({name:z.ViewPost,hash:"|publish"})},k=()=>{v.value=!0,r.loading.value&&r.fetchNext()},M=e=>{const l=e.currentTarget;l.scrollTop+l.offsetHeight+10>=l.scrollHeight&&r.fetchNext()};return ee(()=>{r.refresh()}),()=>a(q,{title:i.value?"修改文章":"撰写新文章",actionsElement:a(C,null,[a(H,{data:t,onHandleYamlParsedMeta:e=>{const{title:l,slug:s,...o}=e;t.title=l??t.title,t.slug=s??t.slug,t.meta={...o}}},null),a(V,{icon:a(L,null,null),onClick:P},null)]),footerButtonElement:a(C,null,[a("button",{onClick:k},[a(Y,null,{default:()=>[a($,null,null)]})])])},{default:()=>[a(O,{class:"mt-3 relative z-10",label:"想想取个什么标题好呢~",value:t.title,onChange:e=>{t.title=e}},null),a("div",{class:"text-gray-500 py-3"},[a("label",{class:"prefix"},[`${F}/${g.value.slug}/`]),a(A,{class:"ml-2",value:t.slug,onChange:e=>{t.slug=e}},null)]),a(E,{loading:!!(i.value&&typeof t.id>"u"),onChange:e=>{t.text=e},text:t.text},null),a(B,{show:v.value,onUpdateShow:e=>{v.value=e},data:t},{default:()=>[a(n,{label:"分类",required:!0,path:"category"},{default:()=>[a(b,{placeholder:"请选择",value:g.value.id,onUpdateValue:e=>{t.categoryId=e},options:u.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),a(n,{label:"标签"},{default:()=>[a(J,{value:t.tags,onUpdateValue:e=>{t.tags.length=0,t.tags.push(...e)}},{input({submit:e}){return a(N({setup(){const s=p([]),o=p(!1),w=p(""),y=p();return h(async()=>{o.value=!0,y.value&&y.value.$el.querySelector("input").focus();const{data:d}=await m.api.categories.get({params:{type:"Tag"}});s.value=d.map(c=>({label:`${c.name} (${c.count})`,value:c.name,key:c.name})),o.value=!1}),()=>a(b,{ref:y,size:"small",value:w.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:s.value,onUpdateValue:d=>{w.value=d,e(d)}},null)}}),null,null)}})]}),a(n,{label:"关联阅读"},{default:()=>[a(b,{maxTagCount:3,filterable:!0,clearable:!0,loading:r.loading.value,multiple:!0,onClear:()=>{r.refresh()},value:t.relatedId,onUpdateValue:e=>{t.relatedId=e},resetMenuOnOptionsChange:!1,options:r.datalist.value.map(e=>({label:e.title,value:e.id,key:e.id,disabled:e.id==t.id})),onScroll:M},null)]}),a(n,{label:"概要"},{default:()=>[a(K,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"文章概要",value:t.summary,onInput:e=>void(t.summary=e)},null)]}),a(n,{label:"版权注明",labelAlign:"right",labelPlacement:"left"},{default:()=>[a(S,{value:t.copyright,onUpdateValue:e=>void(t.copyright=e)},null)]}),a(n,{label:"置顶",labelAlign:"right",labelPlacement:"left"},{default:()=>[a(S,{value:!!t.pin,onUpdateValue:e=>{t.pin=e,e||(t.pinOrder=1)}},null)]}),a(n,{label:"置顶顺序",labelAlign:"right",labelPlacement:"left"},{default:()=>[a(ae,{disabled:!t.pin,value:t.pinOrder,onUpdateValue:e=>void(t.pinOrder=e||1)},null)]})]})]})});export{et as default};
