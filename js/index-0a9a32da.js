import{b$ as ce,c0 as de,c1 as pe,c2 as me,d as w,s as v,b1 as Y,i as x,aE as fe,e as I,ay as A,r as C,w as k,h as e,m as E,aw as B,F as N,aI as ve,c3 as P,L as Z,c4 as ye,t as g,bQ as be,g as K,x as ge,al as ee,R as f,c5 as te,z as we,c6 as he,E as Ne,k as m,l as h,bv as T,av as ae,K as xe,J as ke,I as Ce,A as Ee,p as Se,c7 as Fe,v as le,bk as M,c8 as ue,D as Be,u as Ie,c9 as Ae,ca as $,cb as De,ar as Pe,b as Te,C as je}from"./index-85889586.js";import{R as q}from"./relative-time-40d4f7b6.js";import{H as R}from"./rounded-button-1d5720ce.js";import{m as Oe}from"./marked.esm-d3a6abf7.js";import{c as ne,d as V,N as Ve}from"./DatePicker-2a3767bf.js";import{N as S}from"./Form-cfe354a4.js";import{N as d}from"./FormItem-e974ff62.js";import{N as Le}from"./InputNumber-121c6ffd.js";import{N as re}from"./Switch-aff33488.js";import{N as Ue}from"./DynamicTags-741cd366.js";import{_ as z}from"./CheckCircleOutlined-2857a017.js";import{i as L}from"./isEmpty-54a654e3.js";import{b as Ke}from"./_baseClone-3afb762e.js";import{N as U}from"./Popconfirm-851aecc8.js";import{N as qe,a as _e}from"./ListItem-e5ad8780.js";import{N as Me}from"./ButtonGroup-a7cb8811.js";import{N as $e}from"./DataTable-a8936fb3.js";import{K as Re}from"./index-c79171ca.js";import{U as ze}from"./index-591dc4fe.js";import{N as Ge}from"./Upload-e066b582.js";import{N as He,a as j}from"./Tabs-5b5e2d29.js";import"./ChevronRight-9c7c66f3.js";import"./Select-017984d3.js";import"./Tag-c94d3cf9.js";import"./Forward-c0fc548e.js";import"./Remove-7151b885.js";import"./Add-b97f7bb2.js";import"./prop-8b8caa29.js";import"./vue.runtime.esm-bundler-1827eb7f.js";import"./Checkbox-57192654.js";import"./Pagination-a32d0ce0.js";import"./Ellipsis-3e5ed891.js";import"./Tooltip-60d6807f.js";import"./DynamicInput-833bd791.js";import"./Image-28f65651.js";import"./utils-f8454314.js";import"./throttle-73700e16.js";function We(t){return ce(de(t).toLowerCase())}var Je=pe(function(t,n,u){return n=n.toLowerCase(),t+(u?We(n):n)});const Qe=Je;var Xe=1,Ye=4;function se(t){return Ke(t,Xe|Ye)}function G(t,n,u){return t==null?t:me(t,n,u)}const H=w({props:{condition:{type:[Boolean,Function],required:!0}},setup(t,{slots:n}){const u=()=>{if(typeof t.condition=="function"?t.condition():t.condition)return n.default?.()};return()=>u()}});function O(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Z(t)}const Ze="mt-6",et={class:Ze,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},oe=Symbol("JSONSchemaFormInject"),tt=w({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:t=>t}},setup(t){const n=v(t.initialValue);Y(()=>{t.onValueChange?.(n.value)},{flush:"post"});const u=x(()=>t.schema.definitions),c=x(()=>new Map(Object.entries(t.schema.definitions)));fe(oe,{schema:t.schema,definitions:c,getKey:t.getKey});const r=x(()=>Object.keys(u.value)),o=v([r.value[0]]),a=I(A),i=C(et);return k(()=>a.viewport.value.mobile,l=>{l?(i.labelPlacement="top",i.labelAlign="left"):(i.labelPlacement="left",i.labelAlign="right")},{immediate:!0}),()=>{let l,s;const{schema:p}=t;return e(N,null,[e(ne,{accordion:!0,defaultExpandedNames:o.value,displayDirective:"if"},O(l=r.value.map(y=>{const b=u.value[y];return b.title?e(V,{title:b.title,"data-schema":JSON.stringify(b)},{default:()=>[e(S,i,{default:()=>[e(ie,{dataKey:t.getKey(y),formData:n,schema:b},null)]})]}):null}))?l:{default:()=>[l]}),p.ps.length?e(E,{vertical:!0},O(s=p.ps.map(y=>e(B,{class:"ml-4 mt-8 text-xs inline-block",depth:3},O(y)?y:{default:()=>[y]})))?s:{default:()=>[s]}):null])}}}),ie=w({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0}},setup(t){const{definitions:n,getKey:u}=ve(oe,{});return()=>{const{schema:c,formData:r,dataKey:o}=t;return c?e(N,null,[Object.keys(c.properties).map(a=>{const i=c.properties[a];if(i.$ref){const l=n.value.get(i.$ref.split("/").at(-1));return e(ie,{dataKey:`${u(o)}.${a}`,formData:r,schema:l},null)}return e(at,{value:P(r.value,`${u(o)}.${a}`,void 0),onUpdateValue:l=>{P(r.value,u(o))?G(r.value,`${u(o)}.${a}`,l):G(r.value,u(o),{...P(r.value,u(o),{}),[a]:l})},title:i.title,type:i.type,options:i?.["ui:options"],description:i.description},null)})]):null}}}),at=w({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(t){const n=v(t.value);Y(()=>{t.onUpdateValue(n.value)});const u=()=>{const{options:o}=t;switch(t.type){case"url":case"string":{const{type:a}=o;return e(g,{inputProps:{id:ye()},value:n.value,onUpdateValue:i=>{n.value=i},type:a||"text",showPasswordToggle:!0,autosize:a=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}case"array":return e(Ue,{value:n.value,onUpdateValue:a=>{n.value=a}},null);case"boolean":return e(re,{value:n.value,onUpdateValue:a=>{n.value=a}},null);case"integer":return e(Le,{value:n.value,onUpdateValue:a=>{n.value=a}},null);default:return null}},c=I(A),r=x(()=>c.viewport.value.mobile?1:2);return()=>{const{title:o,options:a,description:i}=t,l=e(N,null,[e(d,{label:o},{default:()=>[i?e(E,{vertical:!0},{default:()=>[u(),e(B,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:Oe.parse(i)},null)]})]}):u()]})]);return a.halfGrid&&r.value===2?e("div",{class:"w-1/2 inline-block"},[l]):l}}}),lt="mt-6",ut={class:lt,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},W={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},nt=w(()=>{const{setHeaderButtons:t}=be();K(()=>{t(e(R,{disabled:!0,onClick:o,icon:e(z,null,null)},null))}),ge(()=>{t(null)});const n=v();ee(async()=>{n.value=await f.api.config.jsonschema.get({transform:!1}),await a()});let u={};const c=C({}),r=v({});k(()=>c,s=>{r.value=te(u,we(s))},{deep:!0}),k(()=>r.value,s=>{let p=!1;L(s)?p=!1:p=!0,t(e(R,{disabled:!p,icon:e(z,null,null),onClick:o},null))});async function o(){if(L(r.value))return;const s=Object.entries(r.value);for await(const[p,y]of s){const b=Object.fromEntries(Object.entries(y).map(([D,_])=>Array.isArray(_)?[D,c[p][D]]:[D,_]));await f.api.options(p).patch({data:b})}await a(),message.success("修改成功")}const a=async()=>{let s=await f.api.options.get();s=he(n.value.default,s),u=se(s),Object.assign(c,s)},i=I(A),l=C(ut);return k(()=>i.viewport.value.mobile,s=>{s?(l.labelPlacement="top",l.labelAlign="left"):(l.labelPlacement="left",l.labelAlign="right")},{immediate:!0}),()=>e(N,null,[e("div",{class:"pt-4"},null),n.value&&e(tt,{initialValue:c,getKey:s=>s.split(".").map(p=>Qe(p)).join(".").replace("Dto",""),schema:n.value},null)])});function J(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Z(t)}const rt=w(()=>{const t=v([]),n=async()=>{const r=await f.api.user.session.get({});t.value=[...r.data]};K(()=>{n()});const u=async(r,o)=>{r?(await f.api.user.logout.post({}),ue(),window.location.reload()):(await f.api.user.session(o).delete({}),t.value=t.value.filter(a=>a.id!==o))},c=async()=>{await Promise.all(t.value.map(r=>{if(!r.current)return u(!1,r.id)})),await n()};return()=>{let r;return e(N,null,[e(Ne,{class:"flex items-center justify-between"},{default:()=>[e("span",{class:"ml-4"},[m("登录设备")]),e(U,{onPositiveClick:c},{trigger(){return e(h,{size:"small",text:!0,type:"error",disabled:t.value.length==1&&t.value[0].current},{default:()=>[m("踢掉全部")]})},default(){return"确定踢掉全部登录设备（除当前会话）？"}})]}),e(qe,{bordered:!0},J(r=t.value.map(({id:o,ua:a,ip:i,date:l,current:s})=>e(_e,{key:o},{prefix(){return e("div",{class:"w-20 text-center"},[s?"当前":null])},suffix(){return e(Me,null,{default:()=>[e(U,{onPositiveClick:()=>u(!!s,o)},{trigger(){return e(h,{tertiary:!0,type:"error"},{default:()=>[s?"注销":"踢"]})},default(){return s?"登出？":"确定要踢出吗？"}})]})},default(){return e(E,{vertical:!0},{default:()=>[e(H,{condition:!!a},{default:()=>[e(T,null,{default:()=>[m("User Agent: "),a]})]}),e(H,{condition:!!i},{default:()=>[e(T,null,{default:()=>[m("IP:")," ",e(ae,{ip:i,triggerEl:e(h,{text:!0,size:"tiny",type:"primary"},J(i)?i:{default:()=>[i]})},null)]})]}),e(T,null,{default:()=>[s?"活跃时间":"登录时间",m(":")," ",e(q,{time:l},null)]})]})}})))?r:{default:()=>[r]}),e("div",{class:"pt-4"},null),e(ne,{defaultExpandedNames:[""],displayDirective:"show"},{default:()=>[e(V,{name:"reset",title:"修改密码"},{default:()=>[e(ot,null,null)]}),e(V,{name:"token",title:"API Token"},{default:()=>[e(st,null,null)]})]})])}}),st=w(()=>{const t=v([]),n=()=>({name:"",expired:!1,expiredTime:new Date}),u=C(n()),c=async()=>{const{data:l}=await f.api.auth.token.get();t.value=l};ee(()=>{c()});const r=v(!1),o=async()=>{const l={name:u.name,expired:u.expired?u.expiredTime.toISOString():void 0},s=await f.api.auth.token.post({data:l});await navigator.clipboard.writeText(s.token),r.value=!1;const p=n();for(const b in p)u[b]=p[b];message.success(`生成成功，Token 已复制，${s.token}`),await c();const y=t.value.findIndex(b=>b.name===l.name);y!==-1&&(t.value[y].token=s.token)},a=async l=>{await f.api.auth.token.delete({params:{id:l}}),message.success("删除成功");const s=t.value.findIndex(p=>p.id===l);s!=-1&&t.value.splice(s,1)},i=I(A);return()=>e(Fe,{class:"!overflow-visible"},{default:()=>[e(xe,{transformOrigin:"center",show:r.value,onUpdateShow:l=>void(r.value=l)},{default:()=>[e(ke,{bordered:!1,title:"创建 Token",class:"max-w-full w-[500px]"},{default:()=>[e(S,null,{default:()=>[e(d,{label:"名称",required:!0},{default:()=>[e(g,{value:u.name,onInput:l=>void(u.name=l)},null)]}),e(d,{label:"是否过期"},{default:()=>[e(re,{value:u.expired,onUpdateValue:l=>void(u.expired=l)},null)]}),e(d,{label:"过期时间"},{default:()=>[e(Ve,{disabled:!u.expired,value:u.expiredTime,type:"datetime",onUpdateValue:l=>void(u.expiredTime=new Date(l))},null)]})]}),e(E,null,{default:()=>[e(h,{round:!0,onClick:()=>void(r.value=!1)},{default:()=>[m("取消")]}),e(h,{round:!0,type:"primary",onClick:o},{default:()=>[m("确定")]})]})]})]}),e(h,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{r.value=!0}},{default:()=>[e(Ce,null,{default:()=>[e(Ee,null,null)]}),e("span",{class:"ml-2"},[m("新增")])]}),e($e,{scrollX:Math.max(800,i.contentWidth.value-i.contentInsetWidth.value),remote:!0,bordered:!1,data:t.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render({token:l}){return l??"*".repeat(40)}},{title:"创建时间",key:"created",render({created:l}){return e(q,{time:l},null)}},{title:"过期时间",key:"expired",render({expired:l}){return Se(l,"yyyy 年 M 月 d 日 HH:mm:ss")}},{title:"操作",key:"id",render({id:l,name:s}){return e(E,null,{default:()=>[e(U,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{a(l)}},{trigger:()=>e(h,{text:!0,type:"error"},{default:()=>[m("删除")]}),default:()=>e("span",{class:"max-w-48"},[m('确定要删除 Token "'),s,m('"?')])})]})}}]},null)]})}),ot=w(()=>{const t=C({password:"",reenteredPassword:""}),n=v(),u=le(),c=async()=>{n.value&&n.value.validate(async o=>{o?console.log(o):(await f.api.master.patch({data:{password:t.password}}),message.success("更改成功"),ue(),u.push({name:Be.Login}))})};function r(o,a){return console.log(o),a===t.password}return()=>e(S,{class:"max-w-[300px]",ref:n,model:t,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:r,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},{default:()=>[e(d,{label:"新密码",required:!0,path:"password"},{default:()=>[e(g,M(W,{value:t.password,onInput:o=>void(t.password=o),type:"password"}),null)]}),e(d,{label:"重复密码",required:!0,path:"reenteredPassword"},{default:()=>[e(g,M(W,{value:t.reenteredPassword,onInput:o=>void(t.reenteredPassword=o),type:"password"}),null)]}),e("div",{class:"w-full text-right"},[e(h,{onClick:c,type:"primary",round:!0},{default:()=>[m("保存")]})])]})}),Q={GitHub:"github",Weibo:"weibo",网易云:"netease",哔哩哔哩:"bilibili"},it="_avatar_7rrjr_3",X={"tab-user":"_tab-user_7rrjr_1",avatar:it},ct=w(()=>{const t=v({});let n;async function u(){const a=await f.api.master.get();t.value=a,n={...a}}K(async()=>{await u()});const c=Ie(),r=x(()=>te(n,t.value)),o=async()=>{const a=se(Pe(r));a.socialIds&&(a.socialIds=t.value.socialIds),await f.api.master.patch({data:a}),c.success("保存成功~"),await u()};return()=>e(N,null,[e(Ae,{cols:"1 400:1 600:2",class:X["tab-user"],xGap:20,yGap:20},{default:()=>[e($,null,{default:()=>[e(S,{class:"flex flex-col justify-center items-center "},{default:()=>[e(d,null,{default:()=>[e("div",{class:X.avatar},[e(ze,{type:"avatar",onFinish:a=>{const{file:i,event:l}=a;try{const s=JSON.parse((l?.target).responseText);t.value.avatar=s.url}catch{}return i}},{default:()=>[e(Ge,{class:"border-0 bg-transparent hover:border-0"},{default:()=>[e(De,{class:"flex",src:t.value.avatar,size:200},null)]})]})])]}),e(d,{label:"上次登录时间",class:"!mt-4"},{default:()=>[e("div",{class:"text-center w-full"},[e(B,null,{default:()=>[t.value.lastLoginTime?e(q,{time:t.value.lastLoginTime},null):"N/A"]})])]}),e(d,{label:"上次登录地址"},{default:()=>[e("div",{class:"text-center w-full"},[t.value.lastLoginIp?e(ae,{trigger:"hover",ip:t.value.lastLoginIp,triggerEl:e(B,{class:"cursor-pointer"},{default:()=>[t.value.lastLoginIp]})},null):"N/A"])]}),e(d,null,{default:()=>[e(h,{round:!0,class:"-mt-14",type:"primary",onClick:o,disabled:L(r.value)},{default:()=>[m("保存")]})]})]})]}),e($,null,{default:()=>[e(S,null,{default:()=>[e(d,{label:"主人名 (username)"},{default:()=>[e(g,{value:t.value.username,onInput:a=>{t.value.username=a?.trim()||""}},null)]}),e(d,{label:"主人昵称 (name)"},{default:()=>[e(g,{value:t.value.name,onInput:a=>{t.value.name=a?.trim()||""}},null)]}),e(d,{label:"主人邮箱 (mail)"},{default:()=>[e(g,{value:t.value.mail,onInput:a=>{t.value.mail=a}},null)]}),e(d,{label:"个人首页"},{default:()=>[e(g,{value:t.value.url,onInput:a=>{t.value.url=a}},null)]}),e(d,{label:"头像"},{default:()=>[e(g,{value:t.value.avatar,onInput:a=>{t.value.avatar=a}},null)]}),e(d,{label:"个人介绍"},{default:()=>[e(g,{type:"textarea",resizable:!1,value:t.value.introduce,onInput:a=>{t.value.introduce=a}},null)]}),e(d,{label:"社交平台 ID 录入"},{default:()=>[e(Re,{options:Object.keys(Q).map(a=>({label:a,value:Q[a]})),onChange:a=>{t.value.socialIds=a},value:t.value.socialIds||{}},null)]})]})]})]})])});var F=function(t){return t.User="user",t.System="system",t.Security="security",t}(F||{});const Wt=w({setup(){const t=Te(),n=le(),u=v(t.params.type);k(()=>t.params.type,r=>{r&&(u.value=r)});const c=v(null);return()=>e(je,{actionsElement:c.value},{default:()=>[e(He,{value:u.value,onUpdateValue:r=>{n.replace({...t,params:{...t.params,type:r}})}},{default:()=>[e(j,{tab:"用户",name:F.User},{default:()=>[e(ct,null,null)]}),e(j,{tab:"系统",name:F.System},{default:()=>[e(nt,null,null)]}),e(j,{tab:"安全",name:F.Security},{default:()=>[e(rt,null,null)]})]})]})}});export{Wt as default};
