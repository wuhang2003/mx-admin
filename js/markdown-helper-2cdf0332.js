import{d as B,s as v,u as D,w as T,h as t,E as C,k as m,m as R,ah as U,l as y,av as V,C as $,z as H,R as M,dr as I}from"./index-f321115e.js";import{l as O}from"./js-yaml-e14800c0.js";import{N as P}from"./Form-ebe5a6e4.js";import{N as b}from"./FormItem-ef02e652.js";import{N as Y}from"./Select-cd564923.js";import{b as _}from"./Upload-37e30513.js";import{N as z}from"./ButtonGroup-f60d56d0.js";import{N}from"./Switch-b5c89778.js";import"./Tag-da0ff8cc.js";import"./Add-c30fd505.js";import"./utils-eb335899.js";import"./Tooltip-70073f6f.js";class W{constructor(a){this.strList=a}parse(a){const l=a,u=/-{3,}\n(.*?)-{3,}\n*(.*)$/gms.exec(l);if(!u)return{text:l};const i=u.pop(),x=O(u[1]),s={},{categories:g,tags:w,date:f,updated:k,created:e}=x;return(f||e)&&(s.date=new Date(f||e).toISOString()),k&&(s.updated=new Date(k).toISOString()),s.categories=g,s.tags=w,Object.keys(s).forEach(d=>{typeof s[d]>"u"&&delete s[d]}),{meta:s,text:i}}start(){const a=this.strList,l=[];for(const u of a)l.push(this.parse(u));return l}}var F=function(n){return n.Post="post",n.Note="note",n}(F||{});const G=[{value:F.Post,label:"博文"},{label:"日记",value:F.Note}],se=B(()=>{const n=v(F.Post),a=v([]),l=v([]);function u(e){return new W(e).start().map((o,r)=>{const h=a.value[r].file.name.replace(/\.md$/,"");return o.meta?o.meta.slug=o.meta.slug??h:o.meta={title:h,slug:h},o.meta?.date||(o.meta.date=new Date().toISOString()),o})}const i=D();async function x(e){if(e?.preventDefault(),e?.stopPropagation(),!a.value.length)throw new ReferenceError("fileList is empty");const d=[];for await(const r of a.value){const c=await Promise.resolve(new Promise((h,E)=>{const p=r.file;if(!p){i.error("文件不存在"),E("File is empty");return}const L=p.name.split(".").pop();if(p.type&&p.type!=="text/markdown"||!["md","markdown"].includes(L)){i.error(`只能解析 markdown 文件，但是得到了 ${p.type}`),E(`File must be markdown. got type: ${p.type}, got ext: ${L}`);return}const A=new FileReader;A.onload=S=>{h(S.target?.result||"")},A.readAsText(p)}));console.log(c),d.push(c)}const o=u(d);i.success("解析完成，结果查看 console 哦"),l.value=o.map((r,c)=>({...r,filename:a.value[c].file?.name??""})),console.log(H(l))}async function s(e){if(e.stopPropagation(),e.preventDefault(),!l.value.length)return i.error("请先解析!!");await M.api.markdown.import.post({data:{type:n.value,data:l.value}}),i.success("上传成功！"),a.value=[]}const g=v(!0),w=v(!1),f=v(!1);async function k(){const e=await M.api.markdown.export.get({params:{slug:f.value,yaml:g.value,show_title:w.value},responseType:"blob"});I(e,"markdown.zip")}return T(()=>a.value,e=>{e.length==0?l.value=[]:x()}),()=>t($,null,{default:()=>[t(C,null,{default:()=>[m("从 MarkDown 导入数据")]}),t(P,{labelAlign:"right",labelPlacement:"left",labelWidth:150,class:"max-w-[300px]"},{default:()=>[t(b,{label:"导入到:"},{default:()=>[t(Y,{options:G,value:n.value,onUpdateValue:e=>void(n.value=e)},null)]}),t(b,{label:"准备好了吗."},{default:()=>[t(R,{vertical:!0},{default:()=>[t(_,{multiple:!0,accept:".md,.markdown",onChange:U(e=>{a.value=e.fileList},250),onRemove:e=>{const o=e.file.name,r=l.value.findIndex(c=>c.filename===o);r!=-1&&l.value.splice(r,1)}},{default:()=>[t(z,null,{default:()=>[t(y,{round:!0},{default:()=>[m("先上传")]}),t(y,{onClick:x,disabled:!a.value.length},{default:()=>[m("再解析")]}),t(y,{onClick:s,round:!0,disabled:!l.value.length},{default:()=>[m("最后导入")]})]})]}),t(V,{depth:2,class:"!text-sm"},{default:()=>[m("只能上传 markdown 文件")]})]})]})]}),t(C,null,{default:()=>[m("导出数据到 Markdown (Hexo YAML Format)")]}),t(P,{labelAlign:"right",labelPlacement:"left",labelWidth:180,class:"max-w-[400px]"},{default:()=>[t(b,{label:"是否包括 yaml header"},{default:()=>[t(N,{value:g.value,onUpdateValue:e=>void(g.value=e)},null)]}),t(b,{label:"是否在第一行显示文章标题"},{default:()=>[t(N,{value:w.value,onUpdateValue:e=>void(w.value=e)},null)]}),t(b,{label:"根据 slug 生成文件名"},{default:()=>[t(N,{value:f.value,onUpdateValue:e=>void(f.value=e)},null)]}),t("div",{class:"text-right w-full"},[t(y,{type:"primary",onClick:k},{default:()=>[m("导出")]})])]})]})});export{se as default};
